<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="./icon2a.svg">
</head>
<body class="bg-gray-100">

<!-- First Page - Consent Formt -->
<div id="consent-page" class="flex md: justify-center items-center h-screen p-4 md:p-0">
    <div class="text-center w-full md:w-3/4 max-w-3xl">
        <h1 class="text-2xl md:text-3xl font-bold mb-4 md:mb-8">Welcome!</h1>
        <p class="text-lg text-left md:text-xl mb-4 md:mb-8">
            We are testing a new chatbot with which people can have faith-based conversations. Your participation should take approximately 30 minutes.
            <br/><br/>
            You will not be asked for any identifying information. Your participation in this research is voluntary. You have the right to withdraw at any point. The principal investigator of this study is Dr. Thomas Meservy and can be contacted at tmeservy@byu.edu. If you have questions regarding your rights as a research participant contact Human Research Protections Program by phone at (801) 422-1461; or by email: BYU.HRPP@byu.edu.
            <br/><br/>
            By clicking the button below, you acknowledge that your participation in the study is voluntary and that You must be 18 years of age or older to participate, and a member, affiliate, or interested in the one of the following religions: a) The Church of Jesus Christ of Latter-day Saints, b) Catholic, or c) Protestant (e.g., Lutherans, Baptists, Methodists, Anglicans, and/or others).
            <br/><br/>
            You may choose to terminate your participation at any time for any reason. The survey is anonymous, and no one will be able to link your answers back to you. Please do not include your name or other information that could be used to identify you in the survey responses.
            <br/><br/>
            There is no payment or reimbursement for participating in this study. Thank you for your consideration!
            <br/><br/>
            Thomas O. Meservy<br/>
            Professor of Information Systems<br/>
            Marriott School of Business<br/>
            Brigham Young University<br/> 
        </p>
        <button id="consent-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">I agree</button>
    </div>
</div>


<!-- Second Page - Instructions -->
<div id="instructions-page" class="flex md: justify-center items-center h-screen p-4 md:p-0 hidden">
    <div class="text-center w-full md:w-3/4 max-w-3xl">
        <h1 class="text-2xl md:text-3xl font-bold mb-4 md:mb-8">Welcome to Gospel Chatbot</h1>
        <p class="text-lg md:text-xl mb-4 md:mb-8">
            On the next screen, you will be given access to select a chatbot that understands the doctrines, history, and organization of various religions. While each chatbot has been trained and configured in a specific way, the answers do not represent official church doctrine or policy but are provided as a safe space where you can explore and enhance your faith.
            <br/><br/>
            Please be aware that ad blockers may interfere with the display of the chat interface. To ensure the experiment runs smoothly, we recommend temporarily disabling your ad blocker if you have one.
            <br/><br/>
            You will be given a few minutes to explore and interact with the chatbot. When the timer runs out, proceed to the survey where we will ask about your experience. When you are ready, click "Next" to begin.
        </p>
        <button id="selectbot-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Next</button>
    </div>
</div>


<!-- Select bot -->
<div id="selectbot-page" class="flex md: justify-center items-center h-screen p-4 md:p-0 hidden">
    <div class="text-center w-full md:w-3/4 max-w-3xl">
        <p class="text-lg md:text-xl mb-4 md:mb-8">
            Please select which bot most closely aligns with your current religion 
            <br/>(or any of them if you don't have a current religion).
        </p>
        <div class="flex justify-center items-center">
            <form id="religion-form" class="text-lg md:text-xl mb-4 md:mb-8 text-left max-w-md">
                <label class="block"><input type="radio" name="religion" value="0" checked> Roman Catholic</label>
                <label class="block"><input type="radio" name="religion" value="1"> Southern Baptist</label>
                <label class="block"><input type="radio" name="religion" value="2"> The Church of Jesus Christ of Latter-day Saints</label>
                <label class="block"><input type="radio" name="religion" value="3"> United Methodist</label>
            </form>
        </div>
        <button id="chat-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Start the Experiment</button>
    </div>
</div>


<!-- - Experiment -->
<div id="experiment-page" class="hidden h-screen flex items-center flex-col p-0">
    <div class="text-center md:w-3/4 lg:w-1/2 w-full">
        <h2 id="instructions" class="text-md md:text-lg mb-4">Please interact with the chatbot for at least 5 minutes.
            A timer is provided for your convenience. 
        </h2>
        <h2 id="instructions2" class="hidden text-md md:text-lg mb-4">You can continue to use the chatbot as long as you would like. When you are ready, please complete the survey.
        </h2>
        <h2 id="timer" class="text-2xl md:text-3xl font-bold mb-4"></h2>
        <button id="survey-btn" class="hidden bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 mt-8 rounded mb-4">Go to Survey</button>
        <!-- Chatbot Embed -->
    </div>
    <div class="text-center md:w-3/4 lg:w-1/2 w-full h-full">
            <div id="chatbot-container" class="w-full h-full flex-grow relative">
            <iframe
                id="chatbot-iframe"
                src="https://www.chatbase.co/chatbot-iframe/Hr63Mj8FbAUYja1DzQQNq"
                class="w-full mx-auto h-full"
                frameborder="0">
            </iframe>
        </div>
    </div>
</div>

<script>
// Helper function to generate unique user ID
function generateUniqueId() {
    const date = new Date();
    const randomPart = Math.random().toString(36).substring(2, 8); // Random string
    return `${date.getFullYear()}${(date.getMonth()+1)}${date.getDate()}-${randomPart}`;
}

const chatbotIds = [
    'Hr63Mj8FbAUYja1DzQQNq',  // Roman Catholic
    'Uem08Rw2SvPsI1nPhS8nL', // Southern Baptist
    'YVPcuCTpE6N4OnuOg623d', // The Church of Jesus Christ of Latter-day Saints
    '-JW-36Uxisry3JSTPod81' // United Methodist
];

// Extract URL parameters
const urlParams = new URLSearchParams(window.location.search);
const sonaID = urlParams.get('sonaID');
const prolificID = urlParams.get('prolificID');
const experimentID = urlParams.get('experimentID');
let selectedReligionIndex; // Declare it here to access globally


// Variables
let timerInterval;
let startTime;
let chatbotRevealedTime;
const uniqueId = generateUniqueId();
let timerValue = 300;

document.getElementById('consent-btn').addEventListener('click', () => {
    document.getElementById('consent-page').classList.add('hidden');
    document.getElementById('instructions-page').classList.remove('hidden');
});

document.getElementById('selectbot-btn').addEventListener('click', () => {
    document.getElementById('instructions-page').classList.add('hidden');
    document.getElementById('selectbot-page').classList.remove('hidden');
});


// Event listener for "Start the Experiment" button
document.getElementById('chat-btn').addEventListener('click', () => {
    document.getElementById('selectbot-page').classList.add('hidden');
    document.getElementById('experiment-page').classList.remove('hidden');

    selectedReligionIndex = document.querySelector('input[name="religion"]:checked').value;
    const iframe = document.getElementById('chatbot-iframe');
    iframe.src = `https://www.chatbase.co/chatbot-iframe/${chatbotIds[selectedReligionIndex]}`;

    if (experimentID=='researcher') {
        timerValue = 10
    }
    startCountdown(timerValue); // 10 seconds countdown
});

// Countdown timer function
function startCountdown(seconds) {
    startTime = Date.now();
    const timerElement = document.getElementById('timer');
    timerInterval = setInterval(() => {
        const minutes = Math.floor(seconds / 60);
        const secs = seconds % 60;
        timerElement.textContent = `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        seconds--;
        if (seconds < 0) {
            clearInterval(timerInterval);
            document.getElementById('timer').classList.add('hidden');
            document.getElementById('instructions').classList.add('hidden');
            document.getElementById('instructions2').classList.remove('hidden');
            document.getElementById('survey-btn').classList.remove('hidden');
            chatbotRevealedTime = Date.now(); // Capture the time when chatbot was revealed
        }
    }, 1000);
}

// Event listener for "Go to Survey" button
document.getElementById('survey-btn').addEventListener('click', () => {
    const totalTime = Math.floor((Date.now() - chatbotRevealedTime) / 1000); // Total time in seconds
    let surveyUrl = `https://byu.az1.qualtrics.com/jfe/form/SV_aXcFcoNab2pjwXA?chatbotSessionID=${uniqueId}&totalTime=${totalTime}`;

    // Append additional parameters if they exist
    if (sonaID) {
        surveyUrl += `&sonaID=${sonaID}`;
    }
    if (prolificID) {
        surveyUrl += `&prolificID=${prolificID}`;
    }
    if (experimentID) {
        surveyUrl += `&experimentID=${experimentID}`;
    }
    if (chatbotIds[selectedReligionIndex]) {
        surveyUrl += `&chatbotID=${chatbotIds[selectedReligionIndex]}`;
    }

    

    // Redirecting to the survey URL
    window.open(surveyUrl, '_blank');
});


</script>
</body>
</html>
